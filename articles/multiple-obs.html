<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multiple Observations • epidemia</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Multiple Observations">
<meta property="og:description" content="epidemia">
<meta property="og:image" content="https://imperialcollegelondon.github.io/epidemia/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS_CHTML.js" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-186908163-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-186908163-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epidemia</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/install.html">Install</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Model
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/model-introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/model-description.html">Description</a>
    </li>
    <li>
      <a href="../articles/model-implementation.html">Implementation</a>
    </li>
    <li>
      <a href="../articles/model-schematic.html">Schematic</a>
    </li>
    <li>
      <a href="../articles/partial-pooling.html">Partial Pooling</a>
    </li>
    <li>
      <a href="../articles/priors.html">Priors</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/flu.html">A Basic Example</a>
    </li>
    <li>
      <a href="../articles/europe-covid.html">A Multilevel Model</a>
    </li>
    <li>
      <a href="../articles/multiple-obs.html">Multiple Observations</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ImperialCollegeLondon/epidemia/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="multiple-obs_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Multiple Observations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ImperialCollegeLondon/epidemia/blob/master/vignettes/multiple-obs.Rmd"><code>vignettes/multiple-obs.Rmd</code></a></small>
      <div class="hidden name"><code>multiple-obs.Rmd</code></div>

    </div>

    
    
<style>
.contents .page-header {
    display: none;
  } 
</style>
<div class="article_container">




<div id="tracking-sars-cov-2-in-england" class="section level1">
<h1 class="hasAnchor">
<a href="#tracking-sars-cov-2-in-england" class="anchor"></a>Tracking SARS-CoV-2 In England</h1>
<hr>
<p>Previous examples conditioned on a single observation series (case and
death counts respectively). Simple models were used for describing
ascertainment rates. The flu <a href="flu.html">example</a> assumed
<em>full ascertainment</em> of infections, while the multilevel <a href="europe-covid.html">example</a> took the IFR to be <em>constant but unknown</em>.
Population adjustments were not considered, and both examples modeled
the entire history of the epidemic from the first observed cases.</p>
<p>Here we model the trajectory of SARS-CoV-2 in England using data over a
two month period from late March 2021 through to the end of May. In
doing so, we relax the aforementioned modeling assumptions and
demonstrate further capabilities of the package. Population adjustments
are applied in order to explicitly account for pre-existing immunity in
the population. The model is conditioned on two observation series:
daily case counts, and positivity from seroprevalence surveys. This example is
inspired by this <a href="https://rss.org.uk/RSS/media/File-library/News/2021/MishraScott.pdf">paper</a>, which uses <strong>epidemia</strong> to track SARS-CoV-2 at the local authority level in the UK.</p>
<p>Fitting the model to case counts requires a model for the case
ascertainment rates (IAR). Unlike in previous examples, we do not assume
that this is constant. While the IFR of Sars-CoV-2 may be broadly stable
over several weeks or months, the IAR could vary frequently, not least
due to changes in testing capacity, surge testing, and the general
prevalence of the disease. Therefore we opt instead to <em>infer the
time-varying IAR from positivity data</em>, which should provide an “anchor”
for the absolute size of the latent infection process. We allow IAR
dynamics to be inferred by modeling it as a random walk.</p>
<p>Our goal is to infer recent infection dynamics, and also to project
future infection and case counts. These goals do not necessitate a
detailed understanding of the fully history of disease dynamics, and is
primarily why we limit ourselves to a two month period. Other reasons
include that modeling the entire history is computationally demanding
and requires more intricate modeling to explain the full trajectory.</p>
<p>First load required packages.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">epidemia</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lubridate</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rstanarm</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">mc.cores</span> <span class="kw">=</span> <span class="kw pkg">parallel</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span>())</pre></body></html></div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<hr>
<p><strong>epidemia</strong> has a data set <code>EnglandNewCases</code> that contains daily
counts of confirmed SARS-CoV-2 infections in England from the 1<sup>st</sup>
January 2020 up to and including the 30<sup>th</sup> May 2021. The data was
downloaded from <span class="citation">Public Health England (<a href="#ref-PHE" role="doc-biblioref">2020</a>)</span> on the 4<sup>nd</sup> of June 2021.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"EnglandNewCases"</span>)
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">EnglandNewCases</span></pre></body></html></div>
<p>The model will be fit to the most recent two months (60 days) of case
count data, starting on the 1<sup>st</sup> April. We take the first modeled date
to be 20 days prior to this initial observation, which is the 12<sup>th</sup>
March. This initial 20 days will be the seeding period.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">data</span>, <span class="no">date</span> <span class="kw">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">date</span>) - <span class="fl">80</span>)
<span class="no">data</span>$<span class="no">cases</span>[<span class="fl">1</span>:<span class="fl">20</span>] <span class="kw">&lt;-</span> <span class="fl">NA</span></pre></body></html></div>
</div>
<div id="transmission-model" class="section level2">
<h2 class="hasAnchor">
<a href="#transmission-model" class="anchor"></a>Transmission Model</h2>
<hr>
<p>As in the flu example, we model <span class="math inline">\(R_t\)</span> as a transformed random walk
with daily updates. In later sections, however, we will make projections
that assume <span class="math inline">\(R_t\)</span> remains at its current value. For this reason, we
provide a new column in <code>data</code> to control the random walk
increments. This will allow us to “stop” the walk updating at dates
after the 30<sup>th</sup> May.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">data</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">dt</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span>(<span class="no">date</span>, <span class="no">date</span> <span class="kw">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2020-04-01"</span>), <span class="fl">NA</span>))</pre></body></html></div>
<p>The model for <span class="math inline">\(R_t\)</span> is</p>
<p><span class="math display">\[
R_t = K g^{-1}\left(\beta_0 + w_t\right),
\]</span></p>
<p>where <span class="math inline">\(K= 7\)</span> and <span class="math inline">\(g\)</span> is the logit link. The term <span class="math inline">\(w_t\)</span> is a random walk
satisfying the recursion <span class="math inline">\(w_t = w_{t-1} + \epsilon_t\)</span> and initial
condition <span class="math inline">\(w_{-1} = 0\)</span>. The daily updates <span class="math inline">\(\epsilon_t\)</span> are given a prior
<span class="math inline">\(\epsilon_t \sim \mathcal{N}(0, \sigma)\)</span>, and the scale hyperparameter
follows <span class="math inline">\(\sigma \sim \mathcal{N}^{+}(0, 0.05)\)</span>. The intercept <span class="math inline">\(\beta_0\)</span>
is assigned a normal prior, so that <span class="math inline">\(\beta_0 \sim \mathcal{N}(-1, 1)\)</span>.
This prior has been chosen to reflect our belief that the epidemic was
under control at start of March. We have, however, provided a large
scale to reflect uncertainty over the initial value. The full
transmission model is represented as follows.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">rt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/epirt.html">epirt</a></span>(<span class="kw">formula</span> <span class="kw">=</span> <span class="fu">R</span>(<span class="no">region</span>, <span class="no">date</span>) ~ <span class="fl">1</span> + <span class="fu"><a href="../reference/rw.html">rw</a></span>(<span class="kw">time</span> <span class="kw">=</span> <span class="no">dt</span>, <span class="kw">prior_scale</span><span class="kw">=</span><span class="fl">0.05</span>),
            <span class="kw">link</span> <span class="kw">=</span> <span class="fu"><a href="../reference/scaled_logit.html">scaled_logit</a></span>(<span class="fl">7</span>), <span class="kw">prior_intercept</span> <span class="kw">=</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/priors.html">normal</a></span>(-<span class="fl">1</span>,<span class="fl">1</span>))</pre></body></html></div>
</div>
<div id="infection-model" class="section level2">
<h2 class="hasAnchor">
<a href="#infection-model" class="anchor"></a>Infection Model</h2>
<hr>
<p>Daily recorded cases are consistently above 1000 over the period
considered. Given the large infection counts, we do not consider
extending the infection model to add variation around the renewal
equation. Such extensions would be useful for modeling the epidemic at a
finer scale, say at the local authority level. Please refer <a href="flu.html">here</a> for
an example of how this is done.</p>
<p>We account for pre-existing immunity through population adjustments,
which were described in the model description. The first modeled
date is the 12<sup>th</sup> of March 2021, over a year before SARS-CoV-2 was
first detected in England. It is likely that prior infection and
vaccination will have induced a degree of immunity within the
population. Accounting for this helps to constrain long term forecasts
for the size of the susceptible population.</p>
<p>Mathematically, our model describes infections <span class="math inline">\(i_t\)</span> for <span class="math inline">\(t&gt;0\)</span> by</p>
<span class="math display">\[\begin{align*}
i'_t &amp; = R_t\sum_{s &lt; t} i_s \pi_{t-s},\\
i_t &amp;= S_t \left( 1 - \exp\left(-\frac{i'_t}{P}\right)\right),
\end{align*}\]</span>
<p>where <span class="math inline">\(P\)</span> is the population size and <span class="math inline">\(S_t\)</span> is the time-varying
susceptible population. We use the same generation distribution <span class="math inline">\(\pi_k\)</span>
as in the <a href="europe-covid.html">multilevel model</a>. The initial susceptible population
<span class="math inline">\(S_{v}\)</span> is given a prior <span class="math inline">\(S_v \sim \mathcal{N}(0.48, 0.10)\)</span>. This is
motivated by an ONS antibody survey <span class="citation">(“Coronavirus (Covid-19) Antibody and Vaccination Data for the Uk - Office for National Statistics,” <a href="#ref-ons_antibody" role="doc-biblioref">n.d.</a>)</span>, which estimates
that 51% of the population in England would have tested positive for
SARS-CoV-2 antibodies between the 8<sup>nd</sup> March and the 14<sup>th</sup> March. It
is important however to distinguish the presence of antibodies from
immunity. An individual’s level of antibodies may be below the required
threshold to test positive, however they may have protection through
T-cells. Similarly the presence of antibodies does not imply immunity.
For these reasons, and due to wide credible intervals for the ONS
estimate, we have used a large standard deviation on the prior immune
population.</p>
<p>The population of England was estimated to be 56,286,961 as of mid-2019
<span class="citation">(“Population Estimates for the Uk, England and Wales, Scotland and Northern Ireland - Office for National Statistics,” <a href="#ref-ons_pop" role="doc-biblioref">n.d.</a>)</span>. This is added to <code>data</code> as a static variable.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">data</span>$<span class="no">pop</span> <span class="kw">&lt;-</span> <span class="no">pop</span> <span class="kw">&lt;-</span>  <span class="fl">56286961</span></pre></body></html></div>
<p>The infection model is expressed as follows.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">inf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/epiinf.html">epiinf</a></span>(<span class="kw">gen</span> <span class="kw">=</span> <span class="no">EuropeCovid</span>$<span class="no">si</span>, <span class="kw">seed_days</span><span class="kw">=</span><span class="fl">20L</span>, <span class="kw">pop_adjust</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">pops</span> <span class="kw">=</span> <span class="no">pop</span>,
              <span class="kw">prior_susc</span> <span class="kw">=</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/priors.html">normal</a></span>(<span class="fl">0.49</span>, <span class="fl">0.1</span>), <span class="kw">prior_seeds</span> <span class="kw">=</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/priors.html">normal</a></span>(<span class="fl">15e3</span>, <span class="fl">2e3</span>))</pre></body></html></div>
</div>
<div id="observation-models" class="section level2">
<h2 class="hasAnchor">
<a href="#observation-models" class="anchor"></a>Observation Models</h2>
<hr>
<p>Models are defined for our two data series: case counts and positivity
rates derived from a seroprevalence study. These are discussed in turn.</p>
<div id="case-counts" class="section level3">
<h3 class="hasAnchor">
<a href="#case-counts" class="anchor"></a>Case Counts</h3>
<p>Letting <span class="math inline">\(Y^{(1)}_{t}\)</span> denote daily case counts, we model
<span class="math inline">\(Y_t^{(1)} \sim \text{QP}(y^{(1)}_t,d)\)</span> and</p>
<p><span class="math display">\[
y_t = \alpha^{(1)}_{t}\left(\frac{1}{7} \sum_{s=1}^{7} i_{t-s-3}\right),
\]</span></p>
<p>where <span class="math inline">\(\text{QP}\)</span> denotes the quasi-poisson distribution with mean
<span class="math inline">\(y^{(1)}_t\)</span> and variance-to-mean ratio <span class="math inline">\(d\)</span>, which is given the prior
<span class="math inline">\(d \sim \mathcal{N}^{+}(10,5)\)</span>. The assumption here is that infections
over the last three days are undetected, and those occurring over the
week before are equally likely to be detected.</p>
<p>The IAR <span class="math inline">\(\alpha_t^{(1)}\)</span> is modeled as a random walk with additional
dummy dummy day-of-week variables to account for a clear weekly pattern
in the data (see Figure <a href="#fig:eng-proj-obs">3</a>). We take</p>
<p><span class="math display">\[
\alpha^{(1)}_t = g^{-1}\left(\beta^{(1)}_0 + w^{(1)}_t + \sum_{k=1}^{6} \gamma_k D_{k,t}\right),
\]</span></p>
<p>where <span class="math inline">\(g\)</span> is the logit-link, <span class="math inline">\(\beta_0^{(1)} \sim \mathcal{N}(0,1.5)\)</span> is
an intercept, and <span class="math inline">\(w_t^{(1)}\)</span> is a random walk following the same model
as the walk for <span class="math inline">\(R_t\)</span>, however starting on the first observation date
(1<sup>st</sup> April) rather than immediately after the seeding period. The
prior on <span class="math inline">\(\beta_0^{(1)}\)</span> has a large scale to reflect our prior
uncertainty over the IAR, allowing the posterior to be largely driven by
the positivity data. The terms <span class="math inline">\(D_{k,t}\)</span> are dummy indicators for the
day of the week, and <span class="math inline">\(\gamma_k \sim \mathcal{N}(0, 0.5)\)</span> are associated
weekday effects. These terms allow modeling weekly seasonality. First
add the day-of-week factors to <code>data</code>.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">data</span>$<span class="no">day</span> <span class="kw">&lt;-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/day.html">wday</a></span>(<span class="no">data</span>$<span class="no">date</span>, <span class="kw">label</span><span class="kw">=</span><span class="no">T</span>)</pre></body></html></div>
<p>The aforementioned model is defined as follows.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">cases</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/epiobs.html">epiobs</a></span>(<span class="kw">formula</span> <span class="kw">=</span> <span class="no">cases</span> ~ <span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">day</span>, <span class="kw">ordered</span> <span class="kw">=</span> <span class="fl">FALSE</span>) +
                  <span class="fu"><a href="../reference/rw.html">rw</a></span>(<span class="kw">time</span> <span class="kw">=</span> <span class="no">dt</span>, <span class="kw">prior_scale</span> <span class="kw">=</span> <span class="fl">0.05</span>),
                <span class="kw">i2o</span> <span class="kw">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>,<span class="fl">3</span>), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>/<span class="fl">7</span>,<span class="fl">7</span>)), <span class="kw">link</span> <span class="kw">=</span> <span class="st">"logit"</span>,
                <span class="kw">prior_intercept</span> <span class="kw">=</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/priors.html">normal</a></span>(<span class="fl">0</span>,<span class="fl">1.5</span>), <span class="kw">prior</span> <span class="kw">=</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/priors.html">normal</a></span>(<span class="fl">0</span>,<span class="fl">0.5</span>),
                <span class="kw">family</span> <span class="kw">=</span> <span class="st">"quasi_poisson"</span>, <span class="kw">prior_aux</span> <span class="kw">=</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/priors.html">normal</a></span>(<span class="fl">10</span>,<span class="fl">5</span>))</pre></body></html></div>
</div>
<div id="seroprevalence-data" class="section level3">
<h3 class="hasAnchor">
<a href="#seroprevalence-data" class="anchor"></a>Seroprevalence Data</h3>
<p>The ONS Infection survey <span class="citation">(“Coronavirus (Covid-19) Infection Survey: England - Office for National Statistics,” <a href="#ref-ons_infections" role="doc-biblioref">n.d.</a>)</span> provides weekly estimates of
positivity rates among the English population. These numbers are based
on repeated RT-PCR tests on a representative sample of the population.
We leverage this data for the week beginning the 28<sup>th</sup> March, and for
the subsequent 6 weeks. We arbitrarily use Thursday of each week as the
representative date for the positivity rates.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">ons</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2021-04-01"</span>) + <span class="fl">7</span> * (<span class="fl">0</span>:<span class="fl">6</span>),
                  <span class="kw">positivity</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.21</span>, <span class="fl">0.17</span>, <span class="fl">0.1</span>, <span class="fl">0.08</span>, <span class="fl">0.07</span>, <span class="fl">0.09</span>, <span class="fl">0.09</span>))
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">data</span>, <span class="no">ons</span>)</pre></body></html></div>
<p>Let <span class="math inline">\(Y_t^{(2)}\)</span> be the observed positivity rate at time <span class="math inline">\(t\)</span>. This is an
estimate of the proportion of the population who, at that point of time,
would test positive on an RT-PCR test. We model this as
<span class="math inline">\(Y_t^{(2)} \sim \mathcal{N}(y_{t}^{(2)}, \sigma^2)\)</span>, where</p>
<p><span class="math display" id="eq:mean-positive">\[\begin{equation} 
y_t^{(2)} = \frac{\sum_{s=1}^{14} i_{t-s-3}}{P}.
\tag{1}
\end{equation}\]</span></p>
<p>Equation <a href="#eq:mean-positive">(1)</a> assumes that those infected in the
previous three days will definitively test negative, and that everyone
infected within the two weeks before this will definitively test
positive. All infections occurring before this will not be detected.
This is, of course, a simplification. A careful model requires an
understanding of the likelihood of testing positive in an RT-PCR test
<span class="math inline">\(k\)</span> days after infection, and also accounting for the
sensitivity/specificity of the tests. We have made the above assumption
in the absence of such information.</p>
<p>Equation <a href="#eq:mean-positive">(1)</a> does not fit within our usual
framework for observations. In particular, there is no explicit
ascertainment rate, and the infection weights <span class="math inline">\(\pi_k\)</span> do not form a
probability distribution. Nonetheless, infections are still weighted
linearly, and this model can be represented as follows.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">data</span>$<span class="no">off</span> <span class="kw">&lt;-</span> <span class="fl">1</span>
<span class="no">ons</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/epiobs.html">epiobs</a></span>(<span class="kw">formula</span> <span class="kw">=</span> <span class="no">positivity</span> ~ <span class="fl">0</span> + <span class="fu"><a href="https://rdrr.io/r/stats/offset.html">offset</a></span>(<span class="no">off</span>),
              <span class="kw">i2o</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>,<span class="fl">3</span>), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>,<span class="fl">14</span>)) * <span class="fl">100</span> / <span class="no">pop</span>, <span class="kw">link</span> <span class="kw">=</span> <span class="st">"identity"</span>,
              <span class="kw">family</span> <span class="kw">=</span> <span class="st">"normal"</span>, <span class="kw">prior_aux</span> <span class="kw">=</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/priors.html">normal</a></span>(<span class="fl">0.01</span>, <span class="fl">2.5e-3</span>))</pre></body></html></div>
<p>Here we have assigned a prior <span class="math inline">\(\sigma \sim \mathcal{N}^+(0.01, 0.0025)\)</span>.
This is motivated by the credible intervals in the ONS study.</p>
</div>
</div>
<div id="fitting-and-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-and-analysis" class="anchor"></a>Fitting and Analysis</h2>
<hr>
<p>The model is fit with the NUTS sampler. In order to ensure a large
enough effective sample size, we increase the maximum tree depth for the
algorithm and use 4,000 iterations.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">fm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/epim.html">epim</a></span>(<span class="kw">rt</span> <span class="kw">=</span> <span class="no">rt</span>, <span class="kw">inf</span> <span class="kw">=</span> <span class="no">inf</span>, <span class="kw">obs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">cases</span>, <span class="no">ons</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">data</span>,
           <span class="kw">iter</span> <span class="kw">=</span> <span class="fl">4e3</span>, <span class="kw">control</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">max_treedepth</span> <span class="kw">=</span> <span class="fl">12</span>), <span class="kw">seed</span><span class="kw">=</span><span class="fl">12345</span>)</pre></body></html></div>
<p>Figure <a href="#fig:eng-rt">1</a> plots credible intervals for <span class="math inline">\(R_t\)</span> over the two
month period for which we have data. The model appears confident that
<span class="math inline">\(R_t\)</span> has risen above <span class="math inline">\(1\)</span> over this time, and indeed daily cases appear
to be rising as of the end of May. The credible intervals widen towards
30<sup>th</sup> May because there is a lag between reproduction numbers and
recording cases.</p>
<div class="figure" style="text-align: center">
<span id="fig:eng-rt"></span>
<img src="multiple-obs_files/figure-html/eng-rt-1.png" alt="$R_t$ in England over the period starting on the 1^st^ April 2021 and ending the 30^th^ May 2021" width="70%"><p class="caption">
Figure 1: <span class="math inline">\(R_t\)</span> in England over the period starting on the 1<sup>st</sup> April 2021 and ending the 30<sup>th</sup> May 2021
</p>
</div>
<p>The role of the population adjustment in this model is best understood
by looking at long term forecasts. As was shown in the multilevel example, to make forecasts we have to construct a new data
frame. This can be passed as the <code>newdata</code> argument to
<code>epidemia</code>’s plotting functions.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">fut</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">date</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">data</span>$<span class="no">date</span>) + <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fl">150</span>), <span class="kw">region</span> <span class="kw">=</span> <span class="st">"England"</span>,
              <span class="kw">cases</span> <span class="kw">=</span> -<span class="fl">1</span>, <span class="kw">dt</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">data</span>$<span class="no">date</span>), <span class="kw">positivity</span> <span class="kw">=</span> -<span class="fl">1</span>, <span class="kw">off</span> <span class="kw">=</span> <span class="fl">1</span>,
              <span class="kw">pop</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">pop</span>[<span class="fl">1</span>])
<span class="no">fut</span>$<span class="no">day</span> <span class="kw">&lt;-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/day.html">wday</a></span>(<span class="no">fut</span>$<span class="no">date</span>, <span class="kw">label</span><span class="kw">=</span><span class="no">T</span>)
<span class="no">newdata</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">data</span>, <span class="no">fut</span>)</pre></body></html></div>
<p>For all dates after the modeled period, the <code>dt</code> column is equal
the the final modeled day (30<sup>th</sup> May). In effect, this fixes the random
walks for <span class="math inline">\(R_t\)</span> and <span class="math inline">\(\alpha_t^{(2)}\)</span> at their most recent value. All
forecasts made here are conditional on this assumption.</p>
<p>Figure <a href="#fig:eng-proj-rt">2</a> forecasts both <span class="math inline">\(R_t\)</span> and cumulative
infections. The leftmost panel shows the <em>unadjusted</em>
reproduction number, which we denote by <span class="math inline">\(R_t^u\)</span>. This is the value of
<span class="math inline">\(R_t\)</span> if the entire population were susceptible, and is
the quantity modeled by <code><a href="../reference/epirt.html">epirt()</a></code>. The <code>adjusted</code> <span class="math inline">\(R_t\)</span> is
then taken to be</p>
<p><span class="math display">\[
R_t = \frac{S_{t-1}}{P} R^{\text{u}}_t.
\]</span></p>
<p>Figure <a href="#fig:eng-proj-rt">2</a> shows that <span class="math inline">\(R_t^u\)</span> remains pathwise
constant over the projected period. <span class="math inline">\(R_t\)</span> on the other hand falls
smoothly as the susceptible population is diminished. Cumulative
infections also taper out as the reduction in <span class="math inline">\(S_t\)</span> causes <span class="math inline">\(R_t\)</span> to fall
below <span class="math inline">\(1\)</span>. The population adjustment serves to <em>constrain</em>
long-term forecasts for the total size of the population. Without this
adjustment infections could continue to rise exponentially over time.</p>
<div class="figure" style="text-align: center">
<span id="fig:eng-proj-rt"></span>
<img src="multiple-obs_files/figure-html/eng-proj-rt-1.png" alt="Long term forecasts for $R_t$ and infections, continuing until the 27^th^ October 2021. The median is plotted in black, while sample paths are in blue. **Left** shows the unadjusted $R_t$, while the **center** shows adjusted $R_t$. The **right** plot shows projected infections over time. These plots are produced with **epidemia**'s spaghetti plot functions." width="100%"><p class="caption">
Figure 2: Long term forecasts for <span class="math inline">\(R_t\)</span> and infections, continuing until the 27<sup>th</sup> October 2021. The median is plotted in black, while sample paths are in blue. <strong>Left</strong> shows the unadjusted <span class="math inline">\(R_t\)</span>, while the <strong>center</strong> shows adjusted <span class="math inline">\(R_t\)</span>. The <strong>right</strong> plot shows projected infections over time. These plots are produced with <strong>epidemia</strong>’s spaghetti plot functions.
</p>
</div>
<p>The top panel of Figure <a href="#fig:eng-proj-obs">3</a> shows the IAR over time.
The IAR exhibits strong weekday effects, and appears to increase during
the first half of April. The pattern repeats after the 30<sup>th</sup> May
because we have stopped the random walk. The bottom two plots
demonstrate that the model is able to fit the observed data well. These
plots have been generated with <code><a href="../reference/plot_linpred.html">plot_linpred()</a></code> and <code><a href="../reference/plot_obs.html">plot_obs()</a></code>.</p>
<div class="figure" style="text-align: center">
<span id="fig:eng-proj-obs"></span>
<img src="multiple-obs_files/figure-html/eng-proj-obs-1.png" alt="Historical estimates for IAR, daily cases, and positivity rates. Also included are 1 month forecasts for each quantity. The **top** panel presents the IAR over time. For illustration, the daily effects have been excluded from this. The **center** shows daily case counts, and the **bottom** gives positivity." width="60%"><p class="caption">
Figure 3: Historical estimates for IAR, daily cases, and positivity rates. Also included are 1 month forecasts for each quantity. The <strong>top</strong> panel presents the IAR over time. For illustration, the daily effects have been excluded from this. The <strong>center</strong> shows daily case counts, and the <strong>bottom</strong> gives positivity.
</p>
</div>
<p>The primary purpose of this example is to demonstrate advanced modeling
in <strong>epidemia</strong>. The model itself has many limitations, These include
the quite naive specification of the prior on <span class="math inline">\(S_t\)</span>, and not accounting
for vaccinations during the modeled period. In addition the <code>i2o</code>
argument used in the observational models is not motivated by data from
previous studies.</p>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
</div>
<div id="refs" class="references">
<div id="ref-ons_antibody">
<p>“Coronavirus (Covid-19) Antibody and Vaccination Data for the Uk - Office for National Statistics.” n.d. <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/healthandsocialcare/conditionsanddiseases/datasets/coronaviruscovid19antibodydatafortheuk">https://www.ons.gov.uk/peoplepopulationandcommunity/healthandsocialcare/conditionsanddiseases/datasets/coronaviruscovid19antibodydatafortheuk</a>.</p>
</div>
<div id="ref-ons_infections">
<p>“Coronavirus (Covid-19) Infection Survey: England - Office for National Statistics.” n.d. <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/healthandsocialcare/conditionsanddiseases/datasets/coronaviruscovid19infectionsurveydata">https://www.ons.gov.uk/peoplepopulationandcommunity/healthandsocialcare/conditionsanddiseases/datasets/coronaviruscovid19infectionsurveydata</a>.</p>
</div>
<div id="ref-ons_pop">
<p>“Population Estimates for the Uk, England and Wales, Scotland and Northern Ireland - Office for National Statistics.” n.d. <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/bulletins/annualmidyearpopulationestimates/latest">https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/bulletins/annualmidyearpopulationestimates/latest</a>.</p>
</div>
<div id="ref-PHE">
<p>Public Health England. 2020. “Official UK Coronavirus Dashboard.” <a href="https://coronavirus.data.gov.uk/details/cases">https://coronavirus.data.gov.uk/details/cases</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by James Scott, Axel Gandy, Swapnil Mishra, Juliette Unwin, Seth Flaxman, Samir Bhatt.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
