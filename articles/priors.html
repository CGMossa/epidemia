<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using Prior Distributions • epidemia</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Using Prior Distributions">
<meta property="og:description" content="epidemia">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epidemia</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/IncidenceOnly.html">Modelling of R  with only Incidence data</a>
    </li>
    <li>
      <a href="../articles/ResolvingProblems.html">Resolving Problems</a>
    </li>
    <li>
      <a href="../articles/TimeDependentR.html">Time-dependent Modelling of R</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Flexible Epidemic Modeling with epidemia</a>
    </li>
    <li>
      <a href="../articles/priors.html">Using Prior Distributions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ImperialCollegeLondon/epidemia/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="priors_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using Prior Distributions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ImperialCollegeLondon/epidemia/blob/master/vignettes/priors.Rmd"><code>vignettes/priors.Rmd</code></a></small>
      <div class="hidden name"><code>priors.Rmd</code></div>

    </div>

    
    
<p><em>Please read the <a href="introduction.html">introductory vignette</a> before this document.</em></p>
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a><span class="header-section-number">1</span> Overview</h1>
<p>Recall the parameterisation for the time-varying reproduction number, given by <a href="#eq:rt">(1.1)</a>.
<span class="math display" id="eq:rt">\[\begin{equation}
R = 2A f\left(X\beta + Zb\right),
\tag{1.1}
\end{equation}\]</span>
where <span class="math inline">\(f\)</span> is the standard logistic function. Prior distributions should be specified for the parameters in <a href="#eq:rt">(1.1)</a>, and for additional model parameters. Here we focus on those arising from <a href="#eq:rt">(1.1)</a>.</p>
<p><em>Please note that the current default priors may not be appropriate,
and should not be relied upon. In future versions of the package,
we hope to set reasonable default priors.</em></p>
<p>The priors for <span class="math inline">\(\beta\)</span> are set using the <code>prior</code> and
<code>prior_intercept</code> arguments. These will only have an effect if the formula
specifies covariates and an intercept respectively. These function similarly
to the same arguments in <a href="https://mc-stan.org/rstanarm/reference/stan_lm.html"><code>stan_lm</code></a>.
To understand which families can be used please refer to
<a href="https://mc-stan.org/rstanarm/reference/priors.html">rstanarm’s priors</a>.</p>
<p>Suppose we are modeling a single group and <a href="#eq:rt">(1.1)</a> specifies an intercept. If <code>center=FALSE</code> in a call to <code>epim</code>, then <code>prior_intercept</code> sets the prior on the raw intercept. If all other covariates are zero at the beginning of the epidemic then
this can be viewed as specifying a prior on the initial reproduction rate. We do not recommend
using <code>center=TRUE</code>, because <code>prior_intercept</code> then refers to
the prior on the intercept after all covariates have been centered. This is a difficult
quantity to intuit for these models.</p>
</div>
<div id="autoscaling-prior" class="section level1">
<h1 class="hasAnchor">
<a href="#autoscaling-prior" class="anchor"></a><span class="header-section-number">2</span> Autoscaling <code>prior</code>
</h1>
<p>The scale of the <code>prior</code> argument may be adjusted internally to attempt to make the prior
is weakly informative. This functionality mirrors that used in <strong>rstanarm</strong>. This rescaling can occur both when the default argument is used, and when
it is user-specified. This adjustment can easily be disabled by setting <code>autoscale=FALSE</code> in the
call to the prior functions. An example of such a call would be <code><a href="https://mc-stan.org/rstanarm/reference/priors.html">rstanarm::normal(autoscale=FALSE)</a></code>.</p>
<p>The automatic scaling rules used for the <code>prior</code> is the same as that in <strong>rstanarm</strong>. For clarity,
we repeat these rules here. Please also refer to <a href="https://mc-stan.org/rstanarm/reference/priors.html">rstanarm’s priors</a> for more information on this.</p>
<ul>
<li>If a predictor has only one unique value, no rescaling occurs.</li>
<li>If it has two unique values, the original scale is divided by the range of the values.</li>
<li>For more than two unique values, the original scale is divided by the standard deviation of the predictor.</li>
</ul>
<p>If you are unsure whether rescaling has occurred, call <code>prior_summary</code> on a fitted model object.
If an adjustment has been made, this will show both the originally specified prior and the scaled version An example is given below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/ImperialCollegeLondon/epidemia">epidemia</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(mc.cores = <span class="kw">parallel</span>::<span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span>())

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"EuropeCovid"</span>)
<span class="kw">args</span> <span class="op">&lt;-</span> <span class="kw">EuropeCovid</span>
<span class="kw">args</span><span class="op">$</span><span class="kw">group_subset</span> <span class="op">&lt;-</span> <span class="st">"France"</span>
<span class="kw">args</span><span class="op">$</span><span class="kw">algorithm</span> <span class="op">&lt;-</span> <span class="st">"meanfield"</span>
<span class="kw">args</span><span class="op">$</span><span class="kw">formula</span> <span class="op">&lt;-</span> <span class="fu">R</span>(<span class="kw">country</span>,<span class="kw">date</span>) <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="kw">schools_universities</span> <span class="op">+</span> <span class="kw">lockdown</span> 
<span class="kw">fm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="st">"epim"</span>, <span class="kw">args</span>)
</pre></div>
<pre><code>## Chain 1: ------------------------------------------------------------
## Chain 1: EXPERIMENTAL ALGORITHM:
## Chain 1:   This procedure has not been thoroughly tested and may be unstable
## Chain 1:   or buggy. The interface is subject to change.
## Chain 1: ------------------------------------------------------------
## Chain 1: 
## Chain 1: 
## Chain 1: 
## Chain 1: Gradient evaluation took 0.000384 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 3.84 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Begin eta adaptation.
## Chain 1: Iteration:   1 / 250 [  0%]  (Adaptation)
## Chain 1: Iteration:  50 / 250 [ 20%]  (Adaptation)
## Chain 1: Iteration: 100 / 250 [ 40%]  (Adaptation)
## Chain 1: Iteration: 150 / 250 [ 60%]  (Adaptation)
## Chain 1: Iteration: 200 / 250 [ 80%]  (Adaptation)
## Chain 1: Iteration: 250 / 250 [100%]  (Adaptation)
## Chain 1: Success! Found best value [eta = 0.1].
## Chain 1: 
## Chain 1: Begin stochastic gradient ascent.
## Chain 1:   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes 
## Chain 1:    100         -829.691             1.000            1.000
## Chain 1:    200         -738.955             0.561            1.000
## Chain 1:    300         -794.204             0.397            0.123
## Chain 1:    400         -557.397             0.404            0.425
## Chain 1:    500         -526.960             0.335            0.123
## Chain 1:    600         -571.741             0.292            0.123
## Chain 1:    700         -508.288             0.268            0.123
## Chain 1:    800         -511.078             0.235            0.123
## Chain 1:    900         -502.494             0.211            0.078
## Chain 1:   1000         -484.642             0.194            0.078
## Chain 1:   1100         -487.820             0.094            0.070
## Chain 1:   1200         -486.272             0.082            0.058
## Chain 1:   1300         -485.741             0.076            0.037
## Chain 1:   1400         -476.123             0.035            0.020
## Chain 1:   1500         -477.569             0.030            0.017
## Chain 1:   1600         -479.089             0.022            0.007   MEDIAN ELBO CONVERGED
## Chain 1: 
## Chain 1: Drawing a sample of size 1000 from the approximate posterior... 
## Chain 1: COMPLETED.</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="co"># default prior scale not adjusted</span>
<span class="fu"><a href="../reference/prior_summary.html">prior_summary</a></span>(<span class="kw">fm</span>)
</pre></div>
<pre><code>## Priors for model 'fm' 
## ------
## Intercept
##  ~ normal(location = 0, scale = 0.5)
## 
## Coefficients
##  ~ normal(location = [0,0], scale = [0.5,0.5])
## ------
## See help('prior_summary.epimodel') for more details</code></pre>
<p>Notice that no rescaling occurs and the default priors are used.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="co"># rescale lockdown indicator</span>
<span class="kw">args</span><span class="op">$</span><span class="kw">data</span><span class="op">$</span><span class="kw">lockdown</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="kw">args</span><span class="op">$</span><span class="kw">data</span><span class="op">$</span><span class="kw">lockdown</span>
<span class="kw">fm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="st">"epim"</span>, <span class="kw">args</span>)
</pre></div>
<pre><code>## Chain 1: ------------------------------------------------------------
## Chain 1: EXPERIMENTAL ALGORITHM:
## Chain 1:   This procedure has not been thoroughly tested and may be unstable
## Chain 1:   or buggy. The interface is subject to change.
## Chain 1: ------------------------------------------------------------
## Chain 1: 
## Chain 1: 
## Chain 1: 
## Chain 1: Gradient evaluation took 0.000261 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 2.61 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Begin eta adaptation.
## Chain 1: Iteration:   1 / 250 [  0%]  (Adaptation)
## Chain 1: Iteration:  50 / 250 [ 20%]  (Adaptation)
## Chain 1: Iteration: 100 / 250 [ 40%]  (Adaptation)
## Chain 1: Iteration: 150 / 250 [ 60%]  (Adaptation)
## Chain 1: Iteration: 200 / 250 [ 80%]  (Adaptation)
## Chain 1: Success! Found best value [eta = 1] earlier than expected.
## Chain 1: 
## Chain 1: Begin stochastic gradient ascent.
## Chain 1:   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes 
## Chain 1:    100         -532.399             1.000            1.000
## Chain 1:    200         -462.373             0.576            1.000
## Chain 1:    300         -442.807             0.399            0.151
## Chain 1:    400         -405.784             0.322            0.151
## Chain 1:    500         -400.645             0.260            0.091
## Chain 1:    600         -398.951             0.217            0.091
## Chain 1:    700         -409.151             0.190            0.044
## Chain 1:    800         -399.645             0.169            0.044
## Chain 1:    900         -400.266             0.150            0.025
## Chain 1:   1000         -397.909             0.136            0.025
## Chain 1:   1100         -400.255             0.037            0.024
## Chain 1:   1200         -398.137             0.022            0.013
## Chain 1:   1300         -402.386             0.019            0.011
## Chain 1:   1400         -397.523             0.011            0.011
## Chain 1:   1500         -398.357             0.010            0.006   MEAN ELBO CONVERGED   MEDIAN ELBO CONVERGED
## Chain 1: 
## Chain 1: Drawing a sample of size 1000 from the approximate posterior... 
## Chain 1: COMPLETED.</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="co"># notice the rescaled prior for lockdown</span>
<span class="fu"><a href="../reference/prior_summary.html">prior_summary</a></span>(<span class="kw">fm2</span>)
</pre></div>
<pre><code>## Priors for model 'fm2' 
## ------
## Intercept
##  ~ normal(location = 0, scale = 0.5)
## 
## Coefficients
##   Specified prior:
##     ~ normal(location = [0,0], scale = [0.5,0.5])
##   Adjusted prior:
##     ~ normal(location = [0,0], scale = [0.500,0.005])
## ------
## See help('prior_summary.epimodel') for more details</code></pre>
<p>Rescaling the lockdown indicator has lead to an adjusted prior on the lockdown coefficient.</p>
</div>
<div id="additional-priors" class="section level1">
<h1 class="hasAnchor">
<a href="#additional-priors" class="anchor"></a><span class="header-section-number">3</span> Additional Priors</h1>
<p><strong>epidemia</strong> offers additional priors on top of those in <strong>rstanarm</strong>. Currently there is just one, <code>shifted_gamma</code>, which can only be used for the <code>prior</code> argument. The addition of this prior is motivated by the priors used in <span class="citation">Flaxman et al. (<a href="#ref-Flaxman2020" role="doc-biblioref">2020</a>)</span>. This essentially allows for
<span class="math display">\[\begin{equation}
\beta_i \sim \text{Gamma}(\alpha,\theta) - \eta,
\end{equation}\]</span>
where <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\theta\)</span> are shape and scale parameters, and <span class="math inline">\(\eta\)</span> is a shift to allow for priors with support below zero.</p>
<div id="priors-on-covariance-matrices" class="section level2">
<h2 class="hasAnchor">
<a href="#priors-on-covariance-matrices" class="anchor"></a><span class="header-section-number">3.1</span> Priors on Covariance Matrices</h2>
<p>Consider a single ‘random-effects’ term in the formula. A good example would be <code>(1 + lockdown | country)</code>. For each group the intercepts and slopes are treated as zero-mean multivariate normal with unknown covariance matrix <span class="math inline">\(\Sigma\)</span>. For our example term, fix one level implied by the factor <code>country</code>, say <code>"Italy"</code>. For this group, there are two coefficients - a random intercept for Italy, and a random slope. Therefore <span class="math inline">\(\Sigma\)</span> has dimension <span class="math inline">\(2 \times 2\)</span>. Coefficients for different groups are treated as independent.</p>
<p><strong>epidemia</strong> borrows from <strong>rstanarm</strong> and uses the <a href="rstanarm%20priors"><code>decov</code></a> prior for <span class="math inline">\(\Sigma\)</span>. This decomposes <span class="math inline">\(\Sigma\)</span> into a variance vector and a correlation matrix. An LKJ prior is used on the correlation matrix, while the variance is decomposed into the product of a simplex vector and the trace of <span class="math inline">\(\Sigma\)</span>. The simplex vector is given a symmetric Dirichlet prior, which the trace is once again decomposed as <span class="math inline">\(tr(\Sigma) = J \kappa\)</span>, where <span class="math inline">\(J\)</span> is the order of <span class="math inline">\(\Sigma\)</span>. Finally <span class="math inline">\(\kappa\)</span> is assigned a scale-invariant prior - specifically a Gamma distribution with give shape and scale hyperparameters. For more information on this, please see <a href="http://mc-stan.org/rstanarm/reference/priors.html">rstanarm priors</a> and this <a href="http://mc-stan.org/rstanarm/articles/glmer.html">vignette</a>.</p>
<p>When the left hand side of the formula has only one term (for example <code>(1 | country)</code>), this prior on the covariance simplifies considerably. <span class="math inline">\(\Sigma\)</span> simply reduces to <span class="math inline">\(\kappa\)</span>, which has a gamma prior.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Flaxman2020">
<p>Flaxman, Seth, Swapnil Mishra, Axel Gandy, H Juliette T Unwin, Thomas A Mellan, Helen Coupland, Charles Whittaker, et al. 2020. “Estimating the effects of non-pharmaceutical interventions on COVID-19 in Europe.” <em>Nature</em>. <a href="https://doi.org/10.1038/s41586-020-2405-7">https://doi.org/10.1038/s41586-020-2405-7</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by James Scott, Axel Gandy, Swapnil Mishra, Juliette Unwin, Seth Flaxman, Samir Bhatt.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
