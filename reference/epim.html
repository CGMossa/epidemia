<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fits an Epidemiological Model — epim • epidemia</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Fits an Epidemiological Model — epim" />
<meta property="og:description" content="Fits a Bayesian epidemiological model specified by the formula argument." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epidemia</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/IncidenceOnly.html">Modelling of R  with only Incidence data</a>
    </li>
    <li>
      <a href="../articles/ResolvingProblems.html">Resolving Problems</a>
    </li>
    <li>
      <a href="../articles/TimeDependentR.html">Time-dependent Modelling of R</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Flexible Epidemic Modeling with epidemia</a>
    </li>
    <li>
      <a href="../articles/plotting.html">Plotting with epidemia</a>
    </li>
    <li>
      <a href="../articles/priors.html">Using Prior Distributions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ImperialCollegeLondon/epidemia/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fits an Epidemiological Model</h1>
    <small class="dont-index">Source: <a href='https://github.com/ImperialCollegeLondon/epidemia/blob/master/R/epim.R'><code>R/epim.R</code></a></small>
    <div class="hidden name"><code>epim.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fits a Bayesian epidemiological model specified by the <code>formula</code> argument.</p>
    </div>

    <pre class="usage"><span class='fu'>epim</span>(
  <span class='no'>formula</span>,
  <span class='no'>data</span>,
  <span class='no'>obs</span>,
  <span class='no'>pops</span>,
  <span class='no'>si</span>,
  <span class='kw'>seed_days</span> <span class='kw'>=</span> <span class='fl'>6</span>,
  <span class='kw'>algorithm</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"sampling"</span>, <span class='st'>"meanfield"</span>, <span class='st'>"fullrank"</span>),
  <span class='kw'>group_subset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>stan_data</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>center</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>prior</span> <span class='kw'>=</span> <span class='kw pkg'>rstanarm</span><span class='kw ns'>::</span><span class='fu'><a href='https://mc-stan.org/rstanarm/reference/priors.html'>normal</a></span>(<span class='kw'>scale</span> <span class='kw'>=</span> <span class='fl'>0.5</span>),
  <span class='kw'>prior_intercept</span> <span class='kw'>=</span> <span class='kw pkg'>rstanarm</span><span class='kw ns'>::</span><span class='fu'><a href='https://mc-stan.org/rstanarm/reference/priors.html'>normal</a></span>(<span class='kw'>scale</span> <span class='kw'>=</span> <span class='fl'>0.5</span>),
  <span class='kw'>prior_covariance</span> <span class='kw'>=</span> <span class='kw pkg'>rstanarm</span><span class='kw ns'>::</span><span class='fu'><a href='https://mc-stan.org/rstanarm/reference/priors.html'>decov</a></span>(<span class='kw'>scale</span> <span class='kw'>=</span> <span class='fl'>0.5</span>),
  <span class='kw'>r0</span> <span class='kw'>=</span> <span class='fl'>3.28</span>,
  <span class='kw'>prior_phi</span> <span class='kw'>=</span> <span class='kw pkg'>rstanarm</span><span class='kw ns'>::</span><span class='fu'><a href='https://mc-stan.org/rstanarm/reference/priors.html'>normal</a></span>(<span class='kw'>location</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>scale</span> <span class='kw'>=</span> <span class='fl'>5</span>),
  <span class='kw'>prior_tau</span> <span class='kw'>=</span> <span class='kw pkg'>rstanarm</span><span class='kw ns'>::</span><span class='fu'><a href='https://mc-stan.org/rstanarm/reference/priors.html'>exponential</a></span>(<span class='kw'>rate</span> <span class='kw'>=</span> <span class='fl'>0.03</span>),
  <span class='kw'>prior_PD</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>sampling_args</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(),
  <span class='kw'>debug</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>An R object of class <code>"formula"</code>. The left hand side must take the form <code>R(group,date)</code>,
with <code>group</code> representing a factor vector indicating group membership (i.e. country, state, age cohort),
and <code>date</code> being a vector of Date objects.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>A dataframe with columns corresponding to the terms appearing in 'formula'. See <a href='https://rdrr.io/r/stats/lm.html'>lm</a>.</p></td>
    </tr>
    <tr>
      <th>obs</th>
      <td><p>A list of lists giving available observations. Each element of 'obs' must itself be a names
list containing the following three elements</p><ul>
<li><p><code>odata</code>: A three column dataframe representing some type of observed data that is a function of the true
number of infections. Examples include recorded incidence, deaths or hospitalisations. The first column
represents group membership and must be coercible to class <code>factor</code>. The second column indicates the observation
date and must be coercible to class <code>Date</code>. The third column contain the data.</p></li>
<li><p><code>rates</code>: A named list specifying the prior for the proportion of infected individuals recorded as an
observation. For example if recording deaths this would be some estimate of each groups infection fatality
ratio (IFR). The priors are assumed normal. Contains:</p><ul>
<li><p><code>means</code>: A two column dataframe giving the estimated mean proportion of
infected individuals recorded as an observation. First column represents the group, while the second
the corresponding proportion.</p></li>
<li><p><code>scale</code>: The standard deviation around the mean values. Default value is 0.1.</p></li>
</ul></li>
<li><p><code>pvec</code>: A probability vector with the following interpretation. Conditional on an observation "event"
(i.e. a single death or hospitalisation etc.), the nth element represents the probability that the individual
was infected exactly n days prior to this.</p></li>
<li><p><code>ptype</code>: A string, either "density", "distribution" or "unadjusted". Indicates how <code>pvec</code> should be treated.
If "density" then rescaled to simplex vector, If "distribution", ensures it takes the form of a distribution function.
If "unadjusted", only checks values are between 0 and 1.
simplex vector. Otherwise, this is treated as a cumulative distribution. Defaults to TRUE.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>pops</th>
      <td><p>A two column dataframe giving the total population of each group. First column represents the group,
with the second giving the corresponding population.</p></td>
    </tr>
    <tr>
      <th>si</th>
      <td><p>A vector representing the serial interval of the disease (a probability vector).</p></td>
    </tr>
    <tr>
      <th>seed_days</th>
      <td><p>Number of days for which to seed infections.</p></td>
    </tr>
    <tr>
      <th>algorithm</th>
      <td><p>One of <code>"sampling"</code>, <code>"meanfield"</code> or <code>"fullrank"</code>. This specifies which <span class="pkg">rstan</span>
function to use for fitting the model.</p></td>
    </tr>
    <tr>
      <th>group_subset</th>
      <td><p>An optional vector specifying a subset of groups to model. Elements should correspond to the group levels
specified through the <code>data</code> argument.</p></td>
    </tr>
    <tr>
      <th>stan_data, debug</th>
      <td><p>Mainly for internal use. Will be removed in future versions.</p></td>
    </tr>
    <tr>
      <th>center</th>
      <td><p>If <code>TRUE</code> then the covariates for the \(R_t\) regression are centered to have mean zero. All of the priors are then interpreted as
prior on the centered covariates. Defaults to <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>prior</th>
      <td><p>Same as in <code><a href='https://mc-stan.org/rstanarm/reference/stan_glm.html'>stan_glm</a></code>. In addition to the <span class="pkg">rstanarm</span> provided <a href='https://mc-stan.org/rstanarm/reference/priors.html'>priors</a>,
a <a href='shifted_gamma.html'>shifted_gamma</a> can be used. <strong>Note:</strong> If <code>autoscale=TRUE</code> (Default) in the call to the prior distribution then
automatic rescaling of the prior may take place.</p></td>
    </tr>
    <tr>
      <th>prior_intercept</th>
      <td><p>Same as in <code><a href='https://mc-stan.org/rstanarm/reference/stan_glm.html'>stan_glm</a></code>. Prior for the regression intercept (if it exists).</p></td>
    </tr>
    <tr>
      <th>prior_covariance</th>
      <td><p>Same as in <code><a href='https://mc-stan.org/rstanarm/reference/stan_glmer.html'>stan_glmer</a></code>. Only used if the <code>formula</code> argument specifies a</p></td>
    </tr>
    <tr>
      <th>r0</th>
      <td><p>The prior expected value of \(R_0\). The maximum \(R_0\) in the simulations will be limited to twice this value.</p></td>
    </tr>
    <tr>
      <th>prior_phi</th>
      <td><p>The prior distribution on \(\phi\). This parameter is described in the introductory vignette, and determined the variance
of the observed data around its mean. Must be a call to <code><a href='https://mc-stan.org/rstanarm/reference/priors.html'>normal</a></code>, which again is transformed to a half normal distribution.</p></td>
    </tr>
    <tr>
      <th>prior_tau</th>
      <td><p>The prior for \(\tau\).This parameter is described in the introductory vignette, and controls the variability in the number of
seeded infections at the beginning of the epidemic. Must be a call to <code><a href='https://mc-stan.org/rstanarm/reference/priors.html'>exponential</a></code>.</p></td>
    </tr>
    <tr>
      <th>prior_PD</th>
      <td><p>Same as in <code><a href='https://mc-stan.org/rstanarm/reference/stan_glm.html'>stan_glm</a></code>. If <code>TRUE</code>, samples parameters from the prior disribution.
Defaults to <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>sampling_args</th>
      <td><p>An (optional) named list of parameters to pass to the <span class="pkg">rstan</span> function used for model fitting,
for example <code><a href='https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html'>rstan::sampling</a></code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Not used.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class "epimodel".</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>epim</code> is the primary model fitting function in <span class="pkg">epidemia</span>, and fits models
in the style of Flaxman et al. (2020)
. Multiple groups (countries/states/age cohorts)
can be modeled simultaneously using multilevel models. The time-varying reproduction number can be
paramterised by a number of covariates through the <code>formula</code> argument. This is reasonably flexible. For example,
random effects terms in the style of the <span class="pkg">lme4</span> package can be included.
The prior distribution on the parameters in the regression are handled through the arguments <code>prior</code>,
<code>prior_intercept</code> and <code>prior_covariance</code>.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Flaxman S, Mishra S, Gandy A, Unwin HJT, Mellan TA, Coupland H, Whittaker C, Zhu H, Berah T, Eaton JW, Monod M, Perez-Guzman PN, Schmit N, Cilloni L, Ainslie KEC, Baguelin M, Boonyasiri A, Boyd O, Cattarino L, Cooper LV, Cucunubá Z, Cuomo-Dannenburg G, Dighe A, Djaafara B, Dorigatti I, van
Elsland SL, FitzJohn RG, Gaythorpe KAM, Geidelberg L, Grassly NC, Green WD, Hallett T, Hamlet A, Hinsley W, Jeffrey B, Knock E, Laydon DJ, Nedjati-Gilani G, Nouvellet P, Parag KV, Siveroni I, Thompson HA, Verity R, Volz E, Walters CE, Wang H, Wang Y, Watson OJ, Winskill P, Xi X, Walker PGT, Ghani AC, Donnelly CA, Riley SM, Vollmer MAC, Ferguson NM, Okell LC, Bhatt S, Team ICCR (2020).
&#8220;Estimating the effects of non-pharmaceutical interventions on COVID-19 in Europe.&#8221;
<em>Nature</em>.
ISSN 1476-4687, doi: <a href='https://doi.org/10.1038/s41586-020-2405-7'>10.1038/s41586-020-2405-7</a>
, <a href='https://doi.org/10.1038/s41586-020-2405-7'>https://doi.org/10.1038/s41586-020-2405-7</a>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"EuropeCovid"</span>)

<span class='no'>args</span> <span class='kw'>&lt;-</span> <span class='no'>EuropeCovid</span>
<span class='no'>args</span>$<span class='no'>algorithm</span> <span class='kw'>&lt;-</span> <span class='st'>"sampling"</span>
<span class='no'>args</span>$<span class='no'>formula</span> <span class='kw'>&lt;-</span> <span class='fu'>R</span>(<span class='no'>country</span>,<span class='no'>date</span>) ~ <span class='fl'>0</span> + <span class='no'>lockdown</span>
<span class='no'>args</span>$<span class='no'>prior</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='shifted_gamma.html'>shifted_gamma</a></span>(<span class='kw'>shape</span> <span class='kw'>=</span> <span class='fl'>1</span>/<span class='fl'>6</span>, <span class='kw'>scale</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>shift</span> <span class='kw'>=</span> -<span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>(<span class='fl'>1.05</span>)/<span class='fl'>6</span>)

<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/do.call.html'>do.call</a></span>(<span class='st'>"epim"</span>, <span class='no'>args</span>)
<span class='fu'><a href='plot_rt.html'>plot_rt</a></span>(<span class='no'>fit</span>, <span class='kw'>group</span> <span class='kw'>=</span> <span class='st'>"Germany"</span>)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by James Scott, Axel Gandy, Swapnil Mishra, Juliette Unwin, Seth Flaxman, Samir Bhatt.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


