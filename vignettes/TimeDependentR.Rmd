
---
title: "Time-dependent Modelling of R"
output: 
  github_document:
    fig_width: 10
    fig_height: 4
vignette: >
  %\VignetteIndexEntry{Time-dpendent Modelling of R}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

## Data

We use the Europe data as example. 
```{r}
library(epidemia)
data("EuropeCovid")
args <- EuropeCovid
```
Set sampling parameters.
```{r}
args$algorithm <- "sampling"
options(mc.cores = parallel::detectCores())
args$sampling_args <- list(iter=200,control=list(adapt_delta=0.95,max_treedepth=15))
```
### Single Countries, Random Walk

Weekly Effect

```{r}
args$group_subset <- c("Italy")
args$formula <- R(country,date) ~  1+rw(date,7) 
args$prior <- rstanarm::normal(location=0,scale=.5)
args$prior_intercept <- rstanarm::normal(location=0,scale=2)
fit <- do.call("epim", args)
```
```{r plotrwItaly}
library(gridExtra)
grid.arrange(plot_obs(fit, type="deaths", "Italy"),plot_rt(fit, "Italy"),nrow=1)
```

### Multiple Countries, Country specific weekly effect via random walk

```{r,results='hide'}
args$group_subset <- c("Germany","United_Kingdom","France","Italy")
args$formula <- R(country,date) ~ (1|country) + (rw(date,7)+0|country)
args$prior <- rstanarm::normal(location=0,scale=.5)
args$prior_intercept <- rstanarm::normal(location=0,scale=1)
fit <- do.call("epim", args)
```

```{r plot4countries}
grid.arrange(plot_rt(fit, "Germany"),plot_rt(fit, "United_Kingdom"),
             plot_rt(fit, "France"),plot_rt(fit, "Italy"),nrow=2)
```

```{r plot4countries}
grid.arrange(plot_obs(fit, type="deaths", "Germany"),plot_obs(fit, type="deaths", "United_Kingdom"),
             plot_obs(fit, type="deaths", "France"),plot_obs(fit, type="deaths", "Italy"),nrow=2)
```

### Splines 


Splines can, in principle, be used as well. For this one can simply
use the functionality in the splines package, below with quadratic
splines for one country..

```{r}
library(splines)
args$formula <- R(country,date) ~ bs(day,df=7,degree=2)
```

Add days to the covariates
```{r}
args$data$day <- as.integer(args$data$date-min(args$data$date))
```


```{r,results='hide'}
args$group_subset <- c("United_Kingdom")
fit <- do.call("epim", args)
```

```{r plotsplineUK}
plot_rt(fit, "United_Kingdom")
```








